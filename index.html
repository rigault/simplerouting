<!doctype html>
<html lang = "fr">
<head>
<meta charset="UTF-8">
<title>RCube</title>
<link rel="icon" type="image/ico" href="favicon.ico">
<link rel="stylesheet" type="text/css" href="index.css">
<script src="marine.js"></script>
</head>
<body>
<header> 
   <div class="container">
      <div class="menu">
         <img src="images/routing.png" alt="Routing symbol" width="200" height="200">
      </diV>
   <div class="main">
         <span class=titlename>Rcube</span>
   </div>
      <div class="notes">
         <img src="images/screenshot.png" alt="screenshot" width="350" height="200">
      </div>
   </div>
   <hr>
</header>

<div class="container">

<div class="menu">
<h2>Table des matières </h2>
   <a href="#chap1">1. Introduction</a>
   <a href="#chap2">2. Procédure d'installation </a>
   <a href="#chap3">3. Documentation</a>
   <a href="#chap4">4. Lancement de l'application</a>
   <a href="#chap5">5. Command Line Interface (CLI)</a>
   <a href="#chap6">6. GPS et AIS</a>
   <a href="#chap7">7. Usage (interface graphique)</a>
   <a href="#chap8">8. Trigonométrie</a>
   <a href="#chap0">9. Algorithmes et concepts</a>
   <a href="#chap10">10. Récupérer des fichiers Grib et les informations météorologiques</a>
   <a href="#chap11">11. ECCODES</a>
   <a href="#chap12">12. Trouver ou générer des polaires</a>
   <a href="#chap13">13. Données géographiques</a>
   <a href="#chap14">14. Les logiciels du marché </a>
   <a href="#chap15">15. Approches en open source </a>
   <a href="#chap16">16. Bugs ou comportements particuliers</a>
   <a href="#chap17">17. Éléments bibliographiques </a>
   <a href="#chap18">18. Programmation</a>

<p></p>

    <table>
      <caption>Acronymes et signification associée</caption>
      <thead>
         <tr>
            <th>Acronyme</th><th>Littéral</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td>ECMWF</td><td>European Centre for <br>Medium-Range Weather Forecasts</td>
         </tr>

         <tr>
            <td>GFS</td><td>Global Forecast System</td>
         </tr>

         <tr>
            <td>GRIB</td><td>General Regularly-distributed <br>Information in Binary</td>
         </tr>
         <tr>
            <td>NOAA</td><td>National Oceanic and Atmosphere <br>Administration</td>
         </tr>
         <tr>
            <td>AWA</td><td>Apparent Wind Angle</td>
         </tr>
         <tr>
            <td>AWS</td><td>Apparent Wind Speed</td>
         </tr>
         <tr>
            <td>HDG</td><td>Heading</td>
         </tr>
         <tr>
            <td>TWA</td><td>True Wind Angle</td>
         </tr>
         <tr>
            <td>TWD</td><td>True Wind Direction</td>
         <tr>
            <td>TWS</td><td>True Wind Speed</td>
         <tr>
            <td>COG</td><td>Course Over Ground</td>
         </tr>
         <tr>
            <td>SOG</td><td>Speed Over Ground</td>
         </tr>
         <tr>
            <td>VMC</td><td>Velocity Made On Course</td>
         </tr>
         <tr>
            <td>VMG</td><td>Velocity Made Good</td>
         </tr>
      </tbody>
   </table>
</div>

<div class="main">

<h1 id="chap1">1. Introduction</h1>
		<p>RCube est un logiciel de routage. Il calcule la route allant
		d’un point origine pOr à un point destination pDest à partir
		d’une date <samp>START_TIME</samp> en utilisant les fichiers météo Grib et
		la polaire du bateau.</p>

		<p>La méthode utilisée est celle des isochrones. A partir du
		point Origine pOr, on calcule tous les points accessibles dans un
		intervalle de temps <samp>T_STEP</samp>. C’est l’isochrone 0. Puis à partir
		de cet isochrone 0, on calcule tous les points accessibles dans
		l’intervalle <samp>T_STEP</samp>. On réitère jusqu’à ce que l’on soit
		arrivé à la destination pDest lorsque c’est possible
		(destination reached). Si la couverture de temps météo est
		insuffisante, on arrête le processus (destination unreached).</p>

		<p>On propose alors une route qui est soit la route optimale allant
		de pOr à pDest, soit la route allant de pOr au point du dernier
		isochrone le plus proche de la destination.</p>

		<p>Les fichiers Grib (General Regularly-distributed Information in
		Binary) sont des fichiers contenant pour un ensemble de coordonnées
		(lat, lon) des valeurs météorologiques.</p>

		<p>Les valeurs qui nous intéressent sont celles qui influencent le
		routage.&nbsp;:</p>

		<ul>
			<li> Le vent à 10 mètres de hauteur,</li>
			<li>Les vagues.</li>
		</ul>

		<p>Il existe aussi des fichiers Grib qui donnent la valeur des
		courants. Ils sont également utilisables par RCube.</p>

		<p>La polaire décrit la vitesse du bateau en fonction de la
		vitesse du vent réel (TWS&nbsp;: True Wind Speed) et de l’angle
		du vent avec l’axe du bateau (TWA&nbsp;: True Wind Angle).</p>

		<p>Il existe également des polaires de vagues qui décrivent en
		fonction de la hauteur des vagues et de l’angle des vagues avec
		le bateau un coefficient mutiplicateur de la vitesse du bateau.
		Typiquement, des vagues face au bateau diminueront sa vitesse
		(exemple 60 %), alors qu’une vaque arrière l’augmentera
		(exemple 120 %).</p>

		<p>D’autres paramètres influencent le routage. On peut définir
		un coefficient <samp>DAY_EFFICIENY</samp> ou
		<samp>NIGHT_EFFICIENCY</samp> qui traduisent la capacité de
		l’équipage. 80 % indiquera que la vitesse prise en compte sera
		de 80% de la vitesse donnée par la polaire du bateau. Il existe
		deux paramètres&nbsp;: Un pour la nuit et un pour le jour, afin de
		refléter une efficacité plus faible la nuit.</p>

		<p>Il est également possible de définir un seuil <samp>THRESHOLD</samp>
		qui définit la vitesse à la voile en dessous de laquelle on
		passera au moteur. La vitesse au moteur est définie par le paramètre <samp>MOTOR_S</samp>.</p>

		<p>Le parametre <samp>X_WIND</samp> est un multiplicateur concernant la vitesse
		du vent. En général, on estimera que le vent qui doit être
		pris en compte est par exemple de 20&nbsp;% supérieur au vent
		trouvé dans le fichier Grib. On donnera alors à <samp>X_WIND</samp> la
		valeur&nbsp;:1.2.</p>

		<p><samp>MAX_WIND</samp> est utilisable pour indiquer une vitesse de vent maximale. Le
		routage privilégiera une route évitant des vents dont la vitesse
		excède ce seuil.</p>

		<p><samp>PENALTY0</samp> est le nombre de minutes perdues lors d’un virement de bord.</p>

		<p><samp>PENALTY1</samp> est le nombre de minutes perdues lors d’un empannage.</p>

		<p>Lors du calcul de l’isochrone suivant, <samp>RANGE_COG</samp>
		définit la l’amplitude -90 à + 90 degrés par rapport à la
		route directe vers la destination.</p>

		<p><samp>COG_STEP</samp> défini la granularité. Par exemple 5 degré.</p>

		<p><b>Abréviations&nbsp;</b>:</p>
		<p>Lat&nbsp;: Latitude</p>
		<p>Lon&nbsp;: Longitude</p>
		<p>pOr&nbsp;: Point Origine</p>
		<p>pDest&nbsp;: Point Destination</p>

		<p><b>Acronymes&nbsp;</b>:</p>
		<p>TWS&nbsp;: True Wind Speed</p>
		<p>TWD&nbsp;: True Wind Direction</p>
		<p>TWA&nbsp;: True Wind Angle - the angle of the boat to the wind</p>
		<p>SOG&nbsp;: Speed over Ground. Vitesses sur le fond.</p>
		<p>COG&nbsp;: Course over Ground. Cap sur le fond.</p>
		<p>AWA&nbsp;: Apparent Wind Angle</p>
		<p>AWS&nbsp;: Apparent Wind Speed</p>
		<p>HDG&nbsp;: heading. Angle de l’axe du bateau avec le nord.</p>
		<p>VMG&nbsp;: Velocity Made Good</p>
		<p>VMC&nbsp;: Velocity Made On Course</p>

		<p><i>Au près&nbsp;: Vmg = cos (twa) * tws.</i></p>

		<p>Les distances sont en miles nautiques.</p>

		<p>Les vitesses sont en nœuds.</p>

		<p>Les fichiers Grib donnent les vitesses en mètres/seconde.</p>

<h1 id="chap2">2. Procédure d'installation </h1>

      <p> Il peut être intéressant de disposer dans son environnement de : </p>

      <p> Python : non obligatoire. Lorsque le paramètre PYTHON est à la valeur 0, RCube utilise l'API curl pour la réception de fichiers Grib par mail.
      Lorsque le paramètre a la valeur 1, alors 3 scripts python sont utlisés. Ceici peut être pratique pour s'adapter à l'environnement de l'ultisateur pour
      la messagerie. </p>

      <p> wgrib2 : cet utilitaire permet notamment d'extraire un sous ensemble d'un fichier Grib. Il est utilisé dans le cas des téléchargement web 
      sur les sites open data de l'ECMWF et de Météo France. Si non installé, le logiciel fonctionne soit avec la NOAA pour le téléchagement direct, soit via la maessagerie.</p>

      <h2>2.1. Installation des librairies et environnement système </h2>

		<h3>Environnement Debian Ubuntu  </h3>
		
      <h4>Préliminaires</h4>
<p> Vérifier que gcc est installé. Si ce n’est pas le cas, l’installer.</p>
<pre><code>
sudo apt install gcc
</code></pre>

		<h4>Installer les bibliothèques</h4>
		<p>Installez les paquets nécessaires pour GTK4, curl, shapelib, eccodes&nbsp;:</p>
<pre>
<code>
sudo apt-get install libgtk-4-dev
sudo apt-get install libwebkit2gtk-4.1-dev
sudo apt-get install -y libcurl4 libcurl4-openssl-dev 
sudo apt-get install libshp-dev
sudo apt-get install -y libeccodes0 libeccodes-dev
</code>
</pre>

      <h4>Installation de la police 7 segments pour Dashboard</h4>
      <code>sudo apt-get install fonts-dseg</code>
      <p>&nbsp;</p>

      <h4>Installation de cdo</h4>
      <code>sudo apt-get install cdo</code>
      <p>&nbsp;</p>

      <h4>Construction du code</h4>

      <p>Compilation et édition de lien avec gcc. Utiliser de préférence le script ccall4 dans csources ou éventuellement le Makefile.</p>
<pre>
<code>
./ccall4
</code>
</pre>
      <h3>Environnement Mac OS</h3>

      <h4>Préliminaires</h4>
		<p>Installer Homebrew (souvent appelé simplement &quot;Brew&quot;)
		qui est un gestionnaire de paquets pour macOS.</p>
<pre>
<code>
/bin/bash -c &quot;$(curl -fsSL <a href="https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh">https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh</a>)&quot;
$ (echo; echo 'eval &quot;$(/usr/local/bin/brew shellenv)&quot;')&gt;&gt; /Users/jeanfrancois/.zprofile
$ eval &quot;$(/usr/local/bin/brew shellenv)&quot; 
</code>
</pre>
		<p>Installer gcc</p>
<pre>
<code>brew install gcc</code>
</pre>
		<h4>Installer les bibliothèques </h4>
		<p>Installez les paquets nécessaires pour GTK4, curl, shapelib, eccodes&nbsp;:</p>
<pre>
<code>
brew install gtk4
brew install eccodes
brew install curl
brew install libshp</code> ou&nbsp;: <code>brew install shapelib
</code>
</pre>
      <h4>Construction du code</h4>

      <p>Compilation et édition de lien avec gcc identique à l'environnement Linux, par exécution du script ccall4.</p>

Peut toutefois nécessiter des ajustements. Par exemple pour l'édition de liens&nbsp;:
<pre>
<code>gcc show.o rutil.o engine.o shputil.o aisgps.o curlutil.o -o show -lcurl -leccodes -lm `pkg-config --cflags --libs gtk4` -I/usr/local/include -L/usr/local/lib</code>
</pre>
   <h4>Gestion de l'interface graphique</h4>
<pre>
<code>$ DISPLAY=:0.0 ; export DISPLAY</code>
</pre>

		<p>Installation du pkg Xquartz&nbsp;!</p>

      <h3>Environnement Windows</h3>

		<h4>Installer MSYS2</h4>

		<p>MSYS2 est une distribution basée sur Cygwin qui utilise <code>pacman</code>
		pour la gestion des packages. Elle est couramment utilisée pour
		installer des outils de développement sous Windows.</p>
		<ul>
			<li>Téléchargez l'installateur
			MSYS2 depuis <a href="https://www.msys2.org/">msys2.org</a>.</li>
			<li>Installez MSYS2 en suivant les instructions.</li>
			<li>Ouvrez une fenêtre de terminal MSYS2 (recherchez &quot;MSYS2
			MSYS&quot; dans le menu Démarrer).</li>
		</ul>
		<p><a href= "https://packages.msys2.org/">Recherche de packages&nbsp;: https://packages.msys2.org/</a></p>

		<h4>Mettre à jour les paquets MSYS2</h4>
		<p>Dans la fenêtre du terminal MSYS2, mettez à jour les paquets
		en exécutant&nbsp;:</p>
		<code>pacman -Syu</code>
		
		<h4>Installer les outils de développement et les bibilothèques</h4>
		<p>Installez toolchain et les paquets nécessaires pour GTK4, curl, shapelib, eccodes&nbsp;:</p>
<pre><code>
pacman -S mingw-w64-x86_64-toolchain 
pacman -S mingw-w64-x86_64-gtk4
pacman -S mingw-w64-x86_64-curl
pacman -S mingw-w64-x86_64-shapelib
pacman -S mingw-w64-x86_64-eccodes
</code></pre>
      <p>Eventuellement (non indispensable mais peut être utile):</p>
<pre><code>
pacman -S mingw-w64-x86_64-cmake
pacman -S git
pacman -S vim: pour editer
</code></pre>

		<h4>Compilation et édition de lien</h4>

      <p>Compilation et édition de lien avec gcc identique à l'environnement Linux, par exécution du script ccall4.</p>


		<h4>Particularité eccodes sous Windows</h4>

		<p>eccodes sous Windows fonctionne, mais une
		variable d’environnement est mal configurée, comme l’indique
		ce message d’erreur&nbsp;:
<pre>		
ECCODES ERROR : Unable to find boot.def. Context path=/mingw64/share/eccodes/definitions
Possible causes:
- The software is not correctly installed
- The environment variable ECCODES_DEFINITION_PATH is defined but incorrect
</pre>
      <p>Pour remédier à ce problème, tapez&nbsp;:</p>
<pre><code>export ECCODES_DEFINITION_PATH=/mingw64/share/eccodes/definitions</code></pre>
      <p></p>
		<h4>Autres particularité Windows</h4>
		<p> Voir partie AIS GPS</p>

      <p> Le fichier routing.par peut nécessiter de ajustements, notamment sur les noms de certains chemins d’accès absolus, à préfixer par C:
Voir fichier <a href="../par/routingwindows.par">routingwindows.par</a>.</p>

		<h2>2.2. Organisation des fichiers </h2>
		<p>Dans le répertoire d’exécution, on doit trouver les répertoires suivants&nbsp;:</p>
		<pre>
csources4
currentgrib
geo
grib
helpdir
isoc
par
pol
py
rte
trace</pre>

		<h4>csources4</h4>
      <p>csources4 contient les programmes sources et le Makefile ainsi que ccall4 et docshow.</p>

		<p>La production du fichier exécutable nécessite les fichiers
		sources .c et .h suivants&nbsp;:</p>
<pre>
engine.c
option.c
rutil.c
aisgps.c
mailutil.c
show4.c

rtypes.h
inline.h
engine.h
option.h
rutil.h
aisgps.h
mailutil.h
</pre>
Ainsi que les fichiers&nbsp;:
<pre>
ccall4
MakeFile
docshow
</pre>
      <p> La commande de compilation et d’édition des liens est dans le
		fichier shell exécutable&nbsp;:</p>
<pre>
<code>./ccall4</code>
</pre>
		<p>Le Makefile peut aussi être utilisé.</p>
		<pre>
<code>Make</code>
      </pre>
		<p> Dans csources4 se trouve aussi le répertoire&nbsp;: html qui contient la documentation produite par
		Doxigen à l'aide de la commande&nbsp;:</p>
		<pre>
<code>doxygen docshow</code>
      </pre>
		<h4>geo</h4>
      <p>Le répertoire geo contient les fichiers géographiques.</p>

      <ul>
		<li>Le répertoire land-polygons-complete-4326 contient les fichiers shapefiles
		(.shp) qui décrivent le fond de carte. Ils sont associés à
		d’autres fichiers, notamment d’indices à ne pas supprimer.</li>

		<li>Le fichier midcodes.txt associe au
		MID (3 premiers chiffres du numéro MMSI identifiant un navire avec
		le système AIS) un nom de pays.</li>

		<li>Le fichiers poi.csv décrit les points d’intérêts spécifiques.</li>

		<li>Le fichiers port.csv décrit les ports.</li>

		<li>Le fichier portprinc.csv 
		associe latitude, longitude et ports principaux du SHOM pour
		l’affichage des marées du SHOM accessible via le menu Web/SHOM.</li>

		<li>Le fichier issea.txt permet de savoir si un point de la carte est «en mer» ou «à terre».</li>

      </ul>

		<h4>grib</h4>
   
      <p>Ce répertoire contient les fichiers Grib, téléchargés par une des méthodes proposées par le logiciel, ou obtenus via un autre logiciel, par exemple xygrib.</p>

      <p> Il est utile que ce répertoire contienne au moins un fichier. C'est pourquoi il est conseillé de ne pas détruire le petit fichier Grib&nbsp;: reference.grb2.</p>
		
      <h4>currentgrib</h4>
      
      <p>Ce répertoire contient les fichiers Grib pour les courants.</p>


		<h4>helpdir</h4>
   
      <p>Ce répertoire contient la documentation.</p>

      <ul>
		<li>index.html (la documentation que vous lisez)</li>
      <li>index.css</li>
      <li>images (répertoire contenant les images référencées dans index.html)</li>
      <li>favicon.ico</li>
		<li>routing.png</li>
      <li>docpar.txt (description des paramètres des fichiers .par)</li>
      <li>clihelp.txt (help pour le mode CLI command line interface).</li>
      </ul>

		<h4>isoc</h4>
      <p>Ce répertoire contient le Dump des isochrones au format csv, produits par le logiciel.</p>

		<h4>par</h4>
      <p>Ce répertoire contient les fichiers de paramètres (scénarios) suffixés par “.par”.</p>

		<p>Le fichier “.par” par défaut est&nbsp;: <a href="../par/routing.par">routing.par</a>.</p>

		<p>La description des paramètres se trouve dans le répertoire
		helpdir, fichier <a href="docpar.txt">docpar.txt</a></p>

		<h4>pol</h4>

		<p>Ce répertoire contient les fichiers polaires au format ".pol" ou ".csv".</p>

		<p>Les polaires suffixées par ".polwave.csv" sont des polaires de vagues, les autres
		sont les polaires habituelles des bateaux.</p>
	
   	<h4>py</h4>

		<p>Ce répertoire contient 3 scripts python permettant de gérer l’acquisition de fichiers Grib par mail.</p>
		
      <h4>rte</h4>

      <p>Ce répertoire contient les fichiers dump des routes au format csv, créés par le logiciel.</p>

		<h4>trace</h4>

      <p>Ce répertoire contient les fichiers dump des traces au format csv, créés par le logiciel.</p>

		<h2>Desktop </h2>

		<p>Le fichier icône associé au programme est&nbsp;:</p>
<pre>
~/.local/share/applications/routing.desktop
</pre>
      <p>Exemple de fichier .desktop&nbsp;:</p>
<pre>
[Desktop Entry]
Name=routing
Exec=/home/rr/routing/routing /home/rr/routing/par/routing.par
Icon=/home/rr/routing/routing.png
Type=Application
StartupNotify=true
Categories=GTK;Utility;
</pre>
      <p>L’image de l’icône est&nbsp;: </p>
<pre>
routing.png
</pre>

<h1 id="chap3">3. Documentation</h1>
<p>La documentation se trouve dans le fichiers suivants&nbsp;:</p>
		<ul>
			<li>Ce fichier index.html et le fichier associé index.css situés dans le
			répertoire helpdir.</li>
			<li>La documentation produite par doxygen, dans le répertoire
			csources4/html et produite par la commande&nbsp;: 
			<pre> doxygen docshow</pre></li>
			<li>Le fichier clihelp situé dans le répertoire helpdir, décrit les commandes en mode
			CLI (Command Line Interface).</li>
			<li>Le fichier docpar.txt situé
			dans le répertoire helpdir décrit l’ensemble des paramètres
			que l’on trouve dans les fichiers suffixés par «&nbsp;.par&nbsp;».</li>
		</ul>

<h1 id="chap4">4. Lancement de l'application</h1>
		<p>Le lancement de l’application se fait via la commande&nbsp;:</p>
		<code>
./routing
      </code>
      <p> Qui est équivalente à</p>
		<code>./routing par/routing.par
      </code>
      <p>Le fichier routing.par doit être présent. C’est le fichier .par par défaut.</p>
		<p>D’autres fichiers de paramètre peuvent être spécifiés dans la ligne de commande.</p>
		<code>./routing par/exemple.par</code>
      <p>Des options sont utilisables pour un mode CLI commande en ligne.</p>

<h1 id="chap5">5. Command Line Interface (CLI)</h1>
		<p>Le programme peux être lancé en mode commande avec des paramètres, utilisés
		essentiellement pour des tests.</p>
<pre>
<code>./routing [-c | -g | -h | -i | -p | -P | -r | -s | -v ] [&lt;parameterFile&gt;]
</code>
</pre>

Voir fichier <a href="../helpdir/clihelp.txt">clihelp.txt</a>.

<h1 id="chap6">6. GPS et AIS</h1>
		<p>Il y a deux méthodes pour acquérir la position GPS&nbsp;et les
		informations AIS&nbsp;:</p>

		<p>Via l’API gpsd. Uniquement disponible sous Unix et Mac OS, ne
		fonctionne par ailleurs pas pour l’AIS mais uniquement pour le GPS. Cette méthode a 
      donc été abandonnée.</p>

		<p>Via la lecture des données directement sur l’interface USB.
		Cette méthode est obligatoire sous Windows et fonctionne aussi
		pour l’AIS, sous Windows comme sous Unix et Mac OS.</p>

		<p>Sous Unix et Mac OS, s’assurer que le port a les droits
		nécessaires. Pour ce faire, passer la commande&nbsp;:</p> 
      <pre><code>sudo chmod 666 /dev/ttyACM0.</code></pre>

		<p>Il existe la possibilité de passer cette commande via le menu
		AIS-GPS, sous menu "NMEA Ports". La saisie du mot de passe admin est
		nécessaire.</p>

		<p class="warning"> Attention&nbsp;:
      Le bon fonctionnement peut nécessiter la déconnexion
		physique de l’interface USB, sa reconnection, le passage de la
		commande changeant les droits d’accès et le re-lancement de
		l’application.</p>

		<p>Les ports utilisés doivent être spécifiés dans le ficher
		routing.par.</p>

      <p>Sous Unix&nbsp;:</p>
<pre><samp>
NMEA: /dev/ttyACM0 13 # 13 pour 9600 bauds
NMEA: /dev/ttyUSB0 15 # 15 pour 38400 bauds
</samp> </pre>

      <p>Sous Windows, la difficulté est de repérer les noms des ports série COM3, COM4…<p>
      <p>La vitesse est donnée explicitement&nbsp;:</p>
<pre><samp>
NMEA: COM3 9600
NMEA: COM4 38400
</samp></pre>

<h1 id="chap7">7. Usage (interface graphique)</h1>
		<h2>7.1 Disposition de l’écran</h2>
      <img src="images/screenshot.png" alt="screenshot" width="350" height="200">

		<p>L'écran présente&nbsp;:</p>
      <ul>
		<li>une barre de menus,</li>
		<li>une ligne de boutons (avec des informations GPS),</li>
		<li>une ligne d'informations,</li>
		<li>la fenêtre où s’affiche la carte, le Grib, les isochrones, …</li>
		<li>une barre d’état indiquant à la position du curseur, la
		latitude, longitude, la vitesse et l’orientation du vent, vaques,
		courant,...</li>
      </ul>

		<h2>7.2. Utilisation de la souris</h2>
		<h3>Clic droit</h3>

      <img src="images/rightclic.png" alt="right clic" width="250" height="450">

		<p>Un clic droit sur la souris fait apparaître
		un menu contextuel qui permet&nbsp;:</p>

      <ul>
		<li>d’afficher un météogramme,</li>
		<li>de définir le point de départ pOr,</li>
		<li>de définir des way points,</li>
		<li>de définir le point d’arrivée pDest,</li>
		<li>de définir des POI (Point Of Interest),</li>
		<li>de définir un polygone. La navigation dans ce polygone est non autorisée.</li>
      </ul>

		<h3>Clic gauche</h3>
		
      <p>Un clic gauche permet de définir une sélection qui lance a recherche
		d’un fichier Grib via l’un des fournisseurs de services sur la
		géographie définie.</p>
      <img src="images/leftclic.png" alt="left clic" width="450" height="300">

		<h3>Molette</h3>
      
		<p>La molette est utilisée pour zoomer et dézoomer.</p>

		<h2>7.3. Clavier</h2>

      <table>
         <caption>Touches et actions associées</caption>
         <thead>
         <tr>
            <th>Touche</th><th>Action</th>
         </tr>
         </thead>
         <tbody>
         <tr>
            <td>ESC</td><td>Sortie</td>
         </tr>
         <tr>
            <td>F1</td><td>Initialise le point d’origine à la position GPS</td>
         </tr>
         <tr>
            <td>Flèches (up, down, right, left)</td><td>Déplacement de la carte à l’écran</td>
         </tr>
         </tbody>
      </table>
      <p></p>

		<h2>7.4. Menus</h2>

		<h3>Menu Grib</h3>

		<p>Ce menu permet d’ouvrir des fichiers Grib (vent, courant) présents
		dans les répertoires "grib" et "currentgrib", d’avoir des informations (métadonnées)
		sur les Grib chargés (vent, courant), de lancer un téléchargement
		sur Météoconsult, de lancer un téléchargement via le service
		Web de la NOAA (administration américaine).</p>

		<p>Noter que le chargement des fichiers Grib auprès de
		fournisseurs de service se fait via la sélection d’une zone
		géographique (voir utilisation de la souris, clic gauche au début
		de ce chapitre).</p>

		<h3>Menus Polar</h3>

		<p>Ce menu permet d’ouvrir les polaires contenues dans le répertoire pol.</p>

		<p>Les fichiers polaires sont des fichiers éditables avec un
		éditeur de texte ou un tableur (Excel…).</p>

		<p>Ce menu permet aussi d’afficher les polaires.</p>

      <img src="images/polar.png" alt="polar" width="550" height="300">

		<h3>Menu Scénarios</h3>

		<p>Ce menu permet de sauvegarder l’état des paramètres, de charger un
		nouveau jeu de paramètre, de les éditer.</p>

      <p>Le sous menu "settings", comme le bouton associé, lance une boîte de dialogue qui présente plusieurs onglets.</p>

      <h4>Onglet display</h4>

      <img src="images/settingsdisplay.png" alt="settings display" width="300" height="450">

      <p>L'onglet display joue essentiellement sur la représentation graphique des informations.</p>

      <h4>Onglet parameter</h4>

      <img src="images/settingsparameter.png" alt="settings parameters" width="300" height="450">

      <p>L'onglet parameter permet de contrôler les informations pilotant la construction des isochrones.</p>

		<h3>Menu Display</h3>

		<p>Ce menu permet l’affichage des différentes informations, dans un
		format assez brut.</p>

		<p>Notez l’existence du sail report, et du routegram.</p>

		<h3>Menu History</h3>

		<p>On peut lancer successivement plusieurs recherches de routes et
		garder trace de l’historique.</p>

		<ul>
         <li>Les routes historiques sont affichées en fushia avec un index
		(0, 1 …).</li>

		   <li>Via cet index, on peut les afficher dans le menu history.</li>

		   <li>Il est possible de réinitialiser l’historique.</li>
      </ul>

		<h3>Menu POI (Point Of Interest)</h3>

		<p>Ce menu permet de visualiser les informations relatives aux POI, de les
		éditer, de sauvegarder l’état des POI si on en a ajouté (voir
		menu contextuel, clic droit, en début de ce chapitre).</p>

		<h3>Menu Trace</h3>

		<p>Ce menu permet de gérer les traces, qui sont sauvegardées dans des
		fichiers .csv.</p>

		<h3>Menu AIS/GPS</h3>

		<p>Ce menu permet l’affichage des informations GPS, des informations AIS et la gestion
		des ports NMEA USB.</p>

		<h3>Menu Web</h3>

		<p>Lance les URL associées avec la localisation (latitude longitude).</p>
		<h3>Menu Help</h3>

		<p>Ce menu permet l’affichage de ce document, du help associé au mode
		CLI, d’un "à propos".</p>

		<h2>7.5. Boutons</h2>

		<p>A l’extrême gauche, le bouton le plus important, Run, lance le calcul d’isochrone</p>

		<p>L’étoile lance une simulation. Il s’agit de choisir la date de
		départ minimisant la durée de traversée. L’exécution peut
		être longue.</p>

		<p>Un bouton permet de lancer la gestion des paramètres. C’est un
		raccourci pour le menu scenario/settings.</p>

		<p>Des boutons de style «&nbsp;magnétoscope&nbsp;» permettent de
		passer au time step suivant ou précédent, de jouer la scène, de mettre en pause…</p>

		<p>Des boutons permettent de zoomer (idem scroll souris).</p>

		<p>Un bouton permet de revenir au centre du Grib.</p>

		<p>Un bouton affiche la palette de couleurs utilisées pour afficher
		la force du vent.</p>

		<p>Un bouton «&nbsp;outils&nbsp;» (clef à molette&nbsp;) est réservé pur le développement.</p>

		<h2>7.6. Zone GPS</h2>
		<p>En partie droite des boutons, affichage la position, de la vitesse et du cap.</p>

		<h2>7.7. Zone routage</h2>
		<p>Lorsque une route a été lancée, la troisième ligne affiche en rouge les
		information de routage au temps correspondant à l’affichage. </p>

<h1 id="chap8" style="page-break-inside: avoid">8. Trigonométrie</h1>
		<h2>8.1. Conventions</h2>

		<p>Le «&nbsp;0&nbsp;» météorologique ou géographique est
		différent du «&nbsp;0&nbsp;» mathématique en ce qui concerne les
		angles.</p>

      <img src="images/mathmeteoangle.jpg" alt="math meteo angle" width="350" height="200">

		<p>&alpha;<sub>Météo</sub> = 90 – &alpha;<sub>Math</sub></p>

		<p>En interne, les angles (TWD, TWA, COG, HDG, AWA..) sont exprimés en degrés décimaux soit sur l’intervalle [-180, 180] soit sur l’intervalle [0, 360[&nbsp;.</p>

      <img src="images/longitudeLatitude.gif" alt="Longitude Latitudee" width="300" height="300">

      <p>Les longitudes sont également exprimées en interne en degrés décimaux:
		
      <ul>
         <li> sur l’intervalle [-180, + 180] dans le cas général,</li>
         <li> sur l’intervalle [0, 360] lorque le Grib utilisé traverse l'antémeridien (dans le pacifique&nbsp;: 180°).</li>
      </ul>

		<p>Les latitudes sont en degrés décimaux sur l’intervalle [-90, + 90]</p>

      <p>Lors de l'affichage, l'expression des latitudes et des longitudes est piloté par le paramètre <samp>DMS_DISP</samp> du fichier "routing.par",
      également modifiable dans la boite de dialogue setting, onglet "display".<p>
      <table>
         <caption>DMS&nbsp;: Degrés Minutes Seconds</caption>
         <thead>
         <tr>
            <th>valeur</th><th>Abbr.</th><th>Signification</th><th>Exemple</th>
         </tr>
         </thead>
         <tbody>
         <tr>
            <td>0</td><td>Basic</td><td>Degrés décimaux</td><td>-10.51°</td>
         </tr>
         <tr>
            <td>1</td><td>DD</td><td>Degrés décimaux</td><td>010.51°W</td>
         </tr>
         <tr>
            <td>2</td><td>DM</td><td>Degrés et minutes décimales</td><td>010°30.6'W</td>
         </tr>
         <tr>
            <td>3</td><td>DMS</td><td>Degrés, minutes et secondes</td><td>010°30'36"W</td>
         </tr>
      </table>

		<h2>8.2. Conversions </h2>

      <p>Soient&nbsp;:</p>

      <p><span class="math">RAD_TO_DEG&nbsp;= 180/π</span> (conversion des degrés en radians)</p>

      <p><span class="math">DEG_TO_RAD&nbsp;= π/180</span> (conversion des radians en degrés)</p>

      <p><span class="math">MS_TO_KN = 3600/1852</span> (conversion des mètres/seconde en nœuds)</p>

      <p><span class="math">HDG</span>&nbsp;: Heading (direction du bateau par rapport au Nord)</p>
     
      <p><span class="math">SOG</span>&nbsp;: Speed Over Ground (Vitesse du bateau en nœuds)</p>

      <p>Les fichiers Grib donnent la composante u et v du vent en m/s à 10 mètres du sol.</p>

      <p>Les valeurs de TWD en degrés et de TWS en nœuds sont&nbsp;:</p>

      <p class ="math">TWD = [180 + RAD_TO_DEG * atan2 (u, v)] % 360</p>

      <p class ="math">TWS = MS_TO_KN * &radic;&nbsp;(u<sup>2</sup> + v<sup>2</sup>)</p>

      <p>Soit <span class ="math">TWA</span> l'angle du vent réel par rapport à l'axe longitudinal du navire.</p>

      <img src="images/twdtwahdg.png" alt="TWD TWA HDG" width="350" height="200">

      <p class ="math">TWA = (TWD - HDG) % 360</p>

      <p>Calcul du vent apparent&nbsp;:</p>

      <p>Le vent apparent est la somme vectorielle&nbsp;:</p>
      <ul>
         <li>du vent réel caractérisé par TWS (vitesse du vent) et TWA (angle du vent par rapport à l'axe longitudinal du bateau),</li>
         <li>du vent vitesse, opposé à l'avancement du navire et donc de vitesse estimée à SOG (Speed Over Ground).</li>
      </ul>

      <img src="images/apparentwind.jpg" alt="vent apparent" width="350" height="200">

      <p>Soient&nbsp;:</p>
      <p class = math>a = TWS * sin (DEG_TO_RAD * TWA)</p>
      <p class = math>b = TWS * cos (DEG_TO_RAD * TWA) + SOG</p>
      <p>On a&nbsp;:</p>
      <p class = "math">AWA = RAD_TO_DEG * atan2 (a, b)</p>
      <p class = "math">AWS = &radic; (a<sup>2</sup> + b<sup>2</sup>)</p>

		<h2>8.3. Loxodromie, orthodromie et correction de Givry </h2>

		<p>La loxodromie, l'orthodromie et la correction de Givry sont des
		concepts liés à la navigation et au calcul des distances sur la
		surface de la Terre. Chacun de ces termes décrit une méthode
		différente pour mesurer ou calculer des distances entre deux
		points géographiques. </p>
      <figure>
         <img src="images/ortholoxo.png" alt="orthodromie loxodromie" width="350" height="200">
         <figcaption>Vert&nbsp;: Orthodromie, Gris&nbsp;: Loxodromie.</figcaption>
      </figure>

		<h3>Loxodromie</h3>

      <p>La loxodromie, également connue sous le nom
		de ligne de loxodromie ou ligne rhumb, est une courbe qui coupe
		tous les méridiens à un angle constant. En d'autres termes, c'est
		une trajectoire sur la surface terrestre qui maintient une
		direction constante par rapport au nord magnétique. </p>

      <p>Soit P1 de latitude <span class="math">lat1</span>, et de longitude <span class="math">lon1</span> exprimées en degrés.</p>

      <p>Soit P2 de latitude <span class="math">lat2</span>, et de longitude <span class="math">lon2</span> exprimées en degrés.</p>

      <p class="math">&delta;lon&nbsp;= lon2 - lon1</p>

      <p class="math">&delta;lat&nbsp;= lat2 - lat1</p>

      <p>Soit <span class="math">&phi;<sub>m</sub></span> la latitude moyenne en degrés&nbsp;:<p>
      
      <p class = math>&phi;<sub>m</sub>= (lat1 + lat2) / 2</p>

      <p>Soient <span class="math">lat1<sub>rad</sub>, lon1<sub>rad</sub>, lat2<sub>rad</sub>, lon2<sub>rad</sub></span> 
      les latitudes et longitudes exprimées en radians des points P1 et P2.

      <p class="math">&delta;lon<sub>rad</sub>&nbsp;= lon2<sub>rad</sub> - lon1<sub>rad</sub></p>

      <p class="math">&delta;lat<sub>rad</sub>&nbsp;= lat2<sub>rad</sub> - lat1<sub>rad</sub></p>

      <p class="math">&phi;<sub>mrad</sub>&nbsp;= (lat1<sub>rad</sub> + lat2<sub>rad</sub>) / 2</p>

      <p><strong>Le cap loxodromique</strong> à suivre de façon constante pour aller de P1 à P2 est en degrés&nbsp;:

      <p class = "math">loxoCap&nbsp;= RAD_TO_DEG * atan2 (&delta;lon * cos (&phi;<sub>mrad</sub>),  &delta;lat)

      <p><strong>La distance loxodromique</strong> nécessite un calcul plus complexe.</p>

      <p>La distance rhumb <span class="math">q</span> est&nbsp;:</p>

      <p class = "math">q = &delta;lat<sub>rad</sub> / log(tan(&pi; / 4 + lat2<sub>rad</sub> / 2) / tan(&pi; / 4 + lat1<sub>rad</sub> / 2))</p>
    
      <p>si <span class="math">q&nbsp;&lt;&nbsp;&epsilon;, q&nbsp;= cos(&phi;<sub>mrad</sub>);</span></p>

      <p>La distance loxodromique en miles nautiques est<p>

      <p class="math">loxoDist&nbsp;= EARTH_RADIUS * &radic;&nbsp;(&delta;lat<sub>rad</sub><sup>2</sup> + (q * &delta;lon<sub>rad</sub>)<sup>2</sup>)</p>


      <p> <span class="math">EARTH_RADIUS ~ 3440.065</span> est le rayon de la terre en miles nautiques.</p>

      <p><strong>Pour les distances faibles, une approximation de la distance par la formule de Pythagore</strong> dans laquelle on considère que la terre est plate se calcule aisément&nbsp;:</p>
 
      <p class="math">pythagoreDist&nbsp;= 60 * &radic;&nbsp; [&delta;lat<sup>2</sup> + (&delta;lon * cos (&phi;<sub>mrad</sub>))<sup>2</sup>]</p>


      <p> <span class="math">&delta;lat, &delta;lon</span> sont les différences en latitudes, longitudes exprimées en degrés. D'où le facteur 60 pour la conversion en miles nautiques. </p>

		<h3>Orthodromie</h3>

      <p>L'orthodromie, également appelée ligne de
		grand cercle, est la trajectoire la plus courte entre deux points
		sur la surface d'une sphère, comme la Terre. Mathématiquement, il
		s'agit de la section d'un grand cercle qui passe par les deux
		points. Contrairement à la loxodromie, l'orthodromie ne maintient
		pas un cap constant et peut sembler courbe sur une carte plate.</p>

      <p>Soit <span class="math">&theta;</span> la différence en longitude entre P1 et P2&nbsp;:

      <p class = "math">&theta;<sub>rad</sub>&nbsp;= lon1<sub>rad</sub> - lon2<sub>rad</sub></p>

      <p>La distance en radians entre P1 et P2 est&nbsp;:<p>

      <p class = "math">distRad&nbsp;= arccos [sin(lat1<sub>rad</sub>) * sin(lat2<sub>rad</sub>) + cos(lat1<sub>rad</sub>) * cos(lat2<sub>rad</sub>) * cos(&theta;<sub>rad</sub>)]</p>
      
      <p><strong>La distance orthodromique</strong> en miles nautiques entre P1 et P2 est&nbsp;:<p>

      <p class = "math">orthoDist&nbsp;= 60 * RAD_TO_DEG * distRad<p>

		<h3>Correction de Givry </h3>

      <p>La correction de Givry est une estimation de l'écart entre le cap constant de la loxodromie et le cap initial de l'orhodromie.</p>

      <p>La correction de Givry <span class="math">g</span> s'exprime en degrés par&nbsp;:</p>

      <p class = math>g = 1/2 * (lon1 - lon2) * sin (&phi;<sub>mrad</sub>)</p>

      <p><strong>Le cap initial orthodromique</strong> à suivre au départ de P1 vers P2 est en degrés&nbsp;:

      <p class = "math">orthoCap = loxoCap + g
      

<h1 id="chap9">9. Algorithmes et concepts</h1>
		<h2>9.1. Calcul d’isochrones</h2>

		<h3>Isochrone </h3>

		<p>Les isochrones sont utilisées pour représenter les zones
		accessibles à un voilier dans un laps de temps donné en fonction
		des conditions météorologiques attendues. L'élaboration
		d'isochrones en navigation à voile est étroitement liée à deux
		concepts clés&nbsp;: la polaire de vitesse du bateau et l'utilisation
		de fichiers Grib pour obtenir des données météorologiques. </p>

		<h3>Polaire</h3>

		<p>La polaire de vitesse du bateau est une représentation
		graphique ou numérique des performances d'un voilier sur
		différentes allures (directions par rapport au vent) et pour
		différentes vitesses de vent. Elle indique la vitesse théorique
		du voilier en fonction de l'angle du vent et de la force du vent.</p>

		<h3>Fichiers Grib</h3>

		<p>Les fichiers Grib fournissent des données météorologiques
		sous forme numérique, notamment la vitesse et la direction du
		vent, la pression atmosphérique, et d'autres paramètres. Ces
		fichiers permettent aux navigateurs d'anticiper les conditions
		météorologiques le long de leur itinéraire.</p>

		<h3>Génération des isochrones</h3>

		<p>L’isochrone 0 est la polaire du bateau.</p>

		<p>L’isochrone 1 est calculé à partir de chaque point de
		l’isochrone 0.</p>

		<p>L’isochrone n est calculé à partir de chaque point de
		l’isochrone n-1.</p>

		<p>Pour éviter une croissance exponentielle du nombre de points, on
		procède à une optimisation, visant à garder un nombre de points
		raisonnable pour chaque isochrones.</p>

		<h3>Optimisation par enveloppes convexes </h3>

		<p>Cette méthode (par exemple basée sur les algorithmes de Graham ou de Jarvis) parfois évoquée n'est pas adapté à notre objet car les
		isochrones ne sont en général pas convexes.</p>

		<h3>Optimisation par secteurs</h3>

		<p>La méthode choisie est de définir des secteurs et de ne retenir par secteur que le point le plus proche de la destination.</p>

		<h2>9.2. Détermination de présence d’un point dans un polygones</h2>

		<p>Soit p un point décrit pas sa latitude et sa longitude. Soit po
		un polygone décrit par une suite de points eux mêmes
		décrits par leur latitude et longitude</p>

		<p>La fonction isInPolygon (pt, po) utilise l'algorithme du
		raycasting pour déterminer si le point <code>p</code>
		se trouve à l'intérieur du polygone <code>po</code>.
		L'idée est de tracer un rayon à partir du point <code>p</code>
		dans une direction quelconque et de compter combien de fois ce
		rayon croise les côtés du polygone. Si le nombre de croisements
		est impair, le point est à l'intérieur du polygone.</p>

<h1 id="chap10">10. Récupérer des fichiers Grib et les informations météorologiques</h1>
		<h2>10.1. XyGrib</h2>

      xyGrib est le successeur de zyGrib et est soutenu par <a href = "https://opengribs.org/fr"> opengribs.org </a>

		<p>Télécharger Xygrib. </p>
		<p><a href="https://opengribs.org/fr/xygrib-fr">https://opengribs.org/fr/xygrib-fr</a></p>

		<h2>10.2. NOAA</h2>

		<p>Le site de l’administration américaine (National Oceanic and Atmosphere
		Administration) fournit gratuitement les fichiers Grib avec le modèle
		GFS.</p>

      <p>Le Global Forecast System (GFS) est un modèle de prévision numérique du temps du National Weather Service des États-Unis.</p>

		<p><a href="https://nomads.ncep.noaa.gov/">https://nomads.ncep.noaa.gov/</a></p>

      <p>Le logiciel télécharge les fichiers Grib de la NOAA.</p>

		<p>Noter que chaque téléchargement correspond à un fichier Grib
		associé à un seul "time step". Le programme concaténe donc n
		fichiers Grib dans un seul pour avoir un fichier Grib global.</p>

      <p>Le type préféré est&nbsp;: GFS 0.25 degree</p>

      <p>Exemple d'accès à un fichier&nbsp;:</p>
      <p>Ici : timestep 21.

      <p>https://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl?dir=/gfs.20241124/00/atmos&file=gfs.t00z.pgrb2.0p25.f021&var_GUST=on&var_PRMSL=on&var_PRATE=on&var_UGRD=on&var_VGRD=on&lev_10_m_above_ground=on&lev_surface=on&lev_mean_sea_level=on&subregion=&toplat=-5&leftlon=-40&rightlon=24&bottomlat=-44


      <h2>10.3. ECMWF</h2>
   
      <p>Le site européen propose des données en open data. </p>

      <p><a href="https://data.ecmwf.int/">https://data.ecmwf.int/</a></p>

      <p>Le logiciel télécharge les fichiers Grib de l'ECMWF.</p>

		<p>Comme pour la NOAA, chaque téléchargement correspond à un fichier Grib
		associé à un seul "time step". Le fichier est unique et mondial et contient de 
      nombreux indicateurs non pertinents pour RCube. Le programme filtre donc chaque fichier pour n'extraire que les "shortname" pertinents,
      découpe la région spécifiée, puis concatène les n fichiers Grib dans un seul pour avoir un fichier Grib global.</p>

      <p>Exemple d'accès à un fichier&nbsp;:</p>
      https://data.ecmwf.int/forecasts/20240813/00z/ifs/0p25/oper/20240813000000-0h-oper-fc.grib2

		<h2>10.4. Meteo France</h2>

      <p>Météo France propose des données en open data. </p>

      <p><a href="https://meteo.data.gouv.fr/">Fichiers Grib Météo France</a></p>

      <p>Le logiciel télécharge les fichiers Grib de Météo France.</p>

      <p>Les données sélectionnées par le logiciel ont une résolution de 0.25°<p> 
      <p>Le seul time step disponible est de 3 heures.<p>
      <p>La prévision est au maximum de 102 heures (4 jours et 6 heures) <p>

      <p> Pour la prévision maximale à 102 heures, RCube télécharge 4 fichiers et les concatène.<p>
      <p> L'exemple qui suit indique la structure pour les 4 fichiers</p>

<pre>
https://object.data.gouv.fr/meteofrance-pnt/pnt/2024-12-24T12:00:00Z/arpege/025/SP1/arpege__025__SP1__000H024H__2024-12-24T12:00:00Z.grib2
https://object.data.gouv.fr/meteofrance-pnt/pnt/2024-12-24T12:00:00Z/arpege/025/SP1/arpege__025__SP1__025H048H__2024-12-24T12:00:00Z.grib2
https://object.data.gouv.fr/meteofrance-pnt/pnt/2024-12-24T12:00:00Z/arpege/025/SP1/arpege__025__SP1__049H072H__2024-12-24T12:00:00Z.grib2
https://object.data.gouv.fr/meteofrance-pnt/pnt/2024-12-24T12:00:00Z/arpege/025/SP1/arpege__025__SP1__073H102H__2024-12-24T12:00:00Z.grib2
</pre>
      <p> Comme pour l'ECMWF, RCube applique un filtrage sur les indicateurs pertinents ("shortnames") et sur la zone géographique pour chaque fichier
 avant concaténation. </p>

		<h2>10.5. Meteoconsult</h2>

		<p>La récupération des fichiers Meteoconsult est également automatisée dans le logiciel.</p>
      <p>Les informations Meteconsult sont disponibles sur&nbsp;:
		<a href="https://marine.meteoconsult.fr/services-marine/fichiers-grib">https://marine.meteoconsult.fr/services-marine/fichiers-grib</a>

      <p>La structure des URL est la suivante&nbsp;:</p>

		<p><strong>Vent</strong>&nbsp;:<br>
      https://static1.mclcm.net/c2020/int/cartes/marine/grib/METEOCONSULT<strong>hh</strong>ZVENT_<strong>mmdd</strong>_Centre_Atlantique.grb</p>

		<p><strong>Courant</strong>&nbsp;:<br>
      https://static1.mclcm.net/c2020/int/cartes/marine/grib/METEOCONSULT<strong>00</strong>Z_VENT_<strong>mmdd</strong>_Centre_Atlantique.grb</p>

		<p>Avec&nbsp;:</p>
      <ul>
         <li>hh&nbsp;: heure UTC. Choix entre&nbsp;: 00, 06, 12, 18 pour le vent. Toujours 00 pour le courant.</li>
		   <li>mm&nbsp;: mois </li>
         <li>dd&nbsp;: jour</li>
      </ul>
		<p><strong>Modèle</strong>&nbsp;: METEO CONSULT 
		</p>
		<p><strong>Maille</strong>&nbsp;: 2,5 km pour les zones Europe et 25 km
		pour les zones Atlantique 
		</p>
		<p><strong>Echéances disponibles</strong>&nbsp;: 7 jours en heure par
		heure 
		</p>
		<p><strong>Runs (UTC)</strong>&nbsp;: 00z, 06z, 12z, 18z 
		</p>
		<p><strong>Heures actualisations (UTC)</strong>&nbsp;: 04H00(00z),
		10H00(06z), 16H00(12z), 22H00(18z) 
		</p>
		<p>00Z correspond à minuit UTC, 06Z à 6 heures UTC, 12Z à midi
		UTC et 18Z à 18 heures UTC.</p>

		<h2>10.6. saildocs</h2>

		<p>Automatisé dans le logiciel.</p>
		<p>Voir <a href="http://www.saildocs.com/gribinfo">http://www.saildocs.com/gribinfo</a></p>
		<p>Adresse mail&nbsp;; <a href="mailto:query@saildocs.com">query@saildocs.com</a></p>
		<p>Les fichiers Grib reçu ont un nom de la forme&nbsp;:</p>
		<p>gfsyyyymmddhhmmssxxx.grb</p>

		<h2>10.7. mailASail</h2>

		<p>Automatisé dans le logiciel.</p>
		<p>Adresse mail&nbsp;: <a href="mailto:weather@mailasail.com">weather@mailasail.com</a></p>
		<p>Les fichiers Grib reçu ont un nom de la forme&nbsp;:</p>
		<p>grib_yymmdd_hhmmss_gfs.grb</p>

		<h2>10.8. Globalmarinenet</h2>

		<p>Adresse mail&nbsp;:
		<a href="mailto:gmngrib@globalmarinenet.net">gmngrib@globalmarinenet.net</a>.</p>
		<p class=warning>A éviter. Ne fonctionne pas bien.</p>

   <h2> Cartes isobariques et bulletins </h2>

   Le serveur de la NOAA contient un répertoire de cartes générales.
   <a href = "https://tgftp.nws.noaa.gov/fax/"> cartes générales NOAA </a>
   <p>On s'intéressera en particulier au fichier PYAA01.gif. <a href = "https://tgftp.nws.noaa.gov/fax/PYAA01.gif"> carte atlantique Nord NOAA </a>

   Voir le site Méteo France pour la situation générale :
   <a href = "https://meteofrance.com/isofronts"> carte atlantique Nord Méteo France</a>

<h1 id="chap11">11. ECCODES</h1>

   <p>L'ECMWF (CEP) propose un package qui inclut des API et un ensemble d'outils autour des fichiers GRIB&nbsp;: 
   <a href="https://confluence.ecmwf.int/display/ECC">Page d'acceuil eCodes</a></p>

		<p>ECCODES est une bibliothèque pour la manipulation de données
		Grib en météorologie. Elle est développée par le Centre
		européen pour les prévisions météorologiques à moyen terme
		(ECMWF) ECCODES fournit des outils et des bibliothèques pour lire,
		écrire et manipuler des données Grib.</p>

		<p>Une fois installée, elle donne accès à des commandes en ligne
		et à des API pour langage C, Fortran et Python.</p>

		<p>Exemple d’utilisation des commandes en lignes.</p>

<pre>grib_dump -w shortName=10u/10v 20231015_114045_GFS_P25_.grb2
grib_ls -w stepRange = 6 ...
grib_ls -n parameter grib/gfs20231220232003245.grb
grib_ls -n time grib/gfs20231220232003245.grb
</pre>
     
      <p>Commande permettant de générer un fichier contenant pour toutes
		les latitudes, longitudes les valeurs 10u, 10v, swh pour chaque
		timestep&nbsp;:</p>

		<p>Vent et houle&nbsp;:</p>

<pre>
grib_get_data -L &quot;%.2lf %.2lf&quot; -F &quot;%.2lf&quot; -m -999999 -w shortName=10u/10v/swh -p step,shortName &lt;nomFichier&gt;
</pre>
      <p>-p&nbsp;: key à sortir (ici le timestep et les shortname 10u,
		10v, swh</p>

		<p>-w&nbsp;: (where option)&nbsp;: key=value à sortir, avec un
		slash pour la liste des value associées au même key.</p>

		<p>-m&nbsp;: missing value. On remplace les valeurs manquantes par
		-999999, facile à tester dans le programme.</p>

		<p>-L&nbsp;: formatage des latitudes et longitudes avec les
		conventions du langage C.</p>

		<p>-F&nbsp;: formatage des values avec les conventions du langage
		C.</p>

		<p>Pour le courant, même commande mais avec uCurr et vCurr</p>
<pre>grib_get_data -L &quot;%.2lf %.2lf&quot; -F &quot;%.2lf&quot; -m -999999 -w shortName=ucurr/vcurr -p step,shortName &lt;nomFicher&gt;
</pre>

      <p>Le logiciel décode les fichiers Grib et utilise les indicateurs décrits dans le tableau suivant.</p>
   
      <p> On notera que seuls la indicateurs 10u, 10v pour le vent, swh pour les vaques, et ucurr, vcurr pour le courant sont utilisés pour la calcul des isochrones.</p>

      <p> Les autres indicateurs (rafales, pressions atmosphérique, précipitations), sont utilisés uniquement pour les représentations graphiques.</p>.

      <p style="page-break-inside: avoid; page-break-before: auto; page-break-after: auto">

      <table>
         <caption>Récapitulatif des key/values intéressantes</caption>
         <thead>
         <tr>
            <th>Shortname</th><th>Sémantique</th><th>Unité</th>
         </tr>
         </thead>
         <tbody>
         <tr>
            <td>10u</td><td>10 metre U wind component. Vent horizontal dans le sens Ouest vers Est à 10 mètres de hauteur</td><td>m/s</td>
         </tr>
         <tr>
            <td>10v</td><td>10 metre V wind component. Vent horizontal dans le sens Sud vers Nord à 10 mètres de hauteur</td><td>m/s</td>
         </tr>
         <tr>
            <td>gust</td><td>Rafales. Peut aussi être trouvé avec indicatorOfParameter&nbsp;=&nbsp;180.</td><td>m/s</td>
         </tr>
         <tr>
            <td>swh</td><td>Hauteur des vagues. Sig Waves Height</td><td>m</td>
         </tr>
         <tr>
            <td>ucurr</td><td>Composante U courant</td><td>m/s</td>
         </tr>
         <tr>
            <td>vcurr</td><td>Composante V courant</td><td>m/s</td>
         </tr>
         <tr>
            <td>msl</td><td>Mean sea level pressure. Pression atmosphérique au niveau de la mer</td><td>Pa</td>
         </tr>
         <tr>
            <td>prate</td><td>Precipitation Rate</td><td>kg&nbsp;m<sup>-2&nbsp;</sup>s<sup>-1</sup></td>
         </tr>
         </tbody>
      </table>
      <p></p>

      <p>Extraction des key values.<p>
      <code>grib_copy -w shortName=10u/10v ecmwf.grib2 ecmwf2.grib</code>

   <h2>CDO</h2>

   <p> Note : inutilisé dans la nouvelle version et remplacé par wgrib2 </p>
   
   <p>CDO pour "Climate Data Operators" <a href="https://code.mpimet.mpg.de/projects/cdo">CDO Web Site</a> est un ensemble
   d'opérateurs en ligne de commande permettant de manipuler des modèles météorologiques ou climatologique. Les formats de fichiers
   supportés sont entre autres&nbsp;: GRIB 1/2. Il y a plus de 600 opérateurs disponibles.</p>

   <p>RCube utilisait CDO au travers de deux opérateurs.<p>
   <ul>
      <li><code>-sellonlatbox</code> pour extraire une région</li>
      <li><code>-invertlat</code> pour inverser les latitudes</li>
   </ul>
   <p>Exemple&nbsp;</p>
<pre><code>
   cdo -sellonlatbox,-25.0,-1.0,20.0,50.0 interECMWF-000 extract.grib
   cdo -invertlat extract.grib extract0.grib
</code></pre>


   <h2>wgrib2</h2>
   <p>RCube utilise maintenant wgrib2 au travers de la commande extrayant une région.<p>
   <p> Si grib2 n'est pas installé, le téléchargement direct des fichiers ECMWF et ARPEGE n'est pas possible </p>

<pre><code>
   wgrib2 input.grib -small_grib lonLeft:lonRight latMin:latMax output.grib

   wgrib2 /home/rr/routing/grib/inter0.tmp -small_grib -13:-1 43:48 /home/rr/routing/grib/inter1.tmp
</code></pre>

<h1 id="chap12">12. Trouver ou générer des polaires</h1>

		<p>Il y a des polaires pour la vitesse du bateau et des polaires
		pour les vagues.</p>

		<h2>12.1. Polaire pour le bateau</h2>

		<p>Un jeu de polaires dont une partie est empruntée à QTVLM se
		trouve dans le répertoire pol.</p>
		<p>Ce sont des fichiers CSV&nbsp;:</p>
		<p>- suffixés par .csv si le séparateur est ";",</p>
		<p>- suffixés par .pol si le séparateur est une tabulation.</p>
		<p>On peut le compléter en consultant le site&nbsp;:
		<a href="http://download.meltemus.com/polars/">http://download.meltemus.com/polars/</a></p>
		<p>Autres sites proposant des polaires (attention au format, des
		adaptations peuvent être nécessaires).</p>
		<p><a href="https://www.blur.se/boats/">https://www.blur.se/boats/</a></p>

		<p>De façon plus compliquée, on peut passer par le site de la
		Fédération Française de Voile.</p>

		<p>Supposons que l’on recherche le Dufour 500.</p>

		<p>Saisir «&nbsp;Dufour500&nbsp;» dans la boite de dialogue à&nbsp;:</p>
      <a href="http://www.ffvoile.fr/ffv/public/Application1/Habitable/HN_Choix.asp">http://www.ffvoile.fr/ffv/public/Application1/Habitable/HN_Choix.asp</a>

		<p>On trouve le Dufour 500. <br>
      Sa classe est&nbsp;: «&nbsp;D&nbsp;».</p>
		
      <p>Son groupe de handicap&nbsp;: 31.5</p>

		<p>Il est possible de retourner sur la page en saisissant maintenant la
		classe D et le groupe de handicap.</p>

		<p><a href="http://www.ffvoile.fr/ffv/public/Application1/Habitable/HN_Choix.asp">http://www.ffvoile.fr/ffv/public/Application1/Habitable/HN_Choix.asp</a></p>

		<p>Ceci permet de vérifier que le Dufour 500 est présent, avec d’autres
		bateaux similaires.</p>

		<p>On peut maintenant rechercher le bateau ou à défaut la même classe
		et un groupe de handicap égal ou proche.</p>

		<p><i>Note&nbsp;: à instruire. Pas trouvé la polaire à ce stade.</i></p>

		<p>Une autre solution consiste à calculer la polaire à partir des
		caractéristiques du bateau.</p>

		<p>Le site <a href="https://www.avalon-routing.com/fr/polaires/">https://www.avalon-routing.com/fr/polaires/</a></p>

		<p>propose cette approche. Le fichier .pol renvoyé par mail ne peut être
		déchiffré que par Avalon Offshore. Ceci étant, une image
		affichant la polaire est affichée sur le site. Il suffit de recopier les valeurs à
		la main dans un tableau .pol ou .csv...</p>

		<p>Il est aussi envisageable de créer ses propres polaires en
		utilisant excel (sauvegarder en fichier .csv) ou un éditeur de
		texte à partir de ses observations...</p>

		<p>Le logiciel RCube peut lancer l’éditeur de texte spécifié
		dans le fichier&nbsp;.par pour éditer la polaire.</p>

		<h2>12.2. Polaires pour les vagues</h2>

		<p>Les polaires vagues sont suffixées par «.polwave.csv&nbsp;».</p>

<h1 id="chap13">13. Données géographiques</h1>
		<h2>13.1. SHP file 
		</h2>
		<p>Natural Earth Data (https://www.naturalearthdata.com/) propose
		des fichers ShapeFile. La bibliothèque shapelib est utilisée.</p>

		<p>Le format Shapefile (SHP) est composé de plusieurs fichiers
		associés. Les fichiers principaux sont généralement&nbsp;:</p>

		<p>.shp (Shapefile)&nbsp;: Contient les données géométriques, telles
		que les points, lignes ou polygones. </p>

		<p>.shx (Shape Index)&nbsp;: Contient un index des enregistrements dans
		le fichier SHP pour permettre un accès rapide. Il est souvent
		utilisé pour améliorer les performances lors de la lecture du
		fichier SHP. </p>

		<p>.dbf (Database file)&nbsp;: Contient des attributs associés aux
		entités géométriques dans le fichier SHP. Chaque enregistrement
		dans le fichier SHP est associé à une ligne dans le fichier DBF.</p>

		<p>Voir spécifications dans&nbsp;:</p>

		<p><a href="https://www.esri.com/content/dam/esrisites/sitecore-archive/Files/Pdfs/library/whitepapers/pdfs/shapefile.pdf">https://www.esri.com/content/dam/esrisites/sitecore-archive/Files/Pdfs/library/whitepapers/pdfs/shapefile.pdf</a></p>

		<h2>13.2. Savoir si un point est sur mer ou sur terre </h2>

		<p>Voir l’excellent site Open Topo Data.</p>

		<p>Le fichier ETOPO1_Ice_g_geotiff.tif est disponible sur le site
		web de la National Oceanic and Atmospheric Administration (NOAA) Le
		fichier est disponible dans une archive zip qui contient le fichier
		raster géoréférencé.</p>

		<p>La commande gdalinfo permet de s’assurer du contenu du
		fichier.</p>

<pre>gdalinfo ETOPO1_Ice_g_geotiff.tif
</pre>
      <p>La commande gdal suivante permet de traduire le fichier .tif en
		fichier texte dont chaque ligne est de la forme&nbsp;:</p>

		<p>lon lat elevation </p>
<pre>gdal_translate -of XYZ -co ADD_HEADER_LINE=YES ETOPO1_Ice_g_geotiff.tif elevation.txt.
</pre>

   <p>Un programme écrit en C appelé transfo.c transforme ce fichier elevation.txt en un fichier texte issea.txt.</p>

	<p>Le fichier issea.txt donne pour chaque point de latitude lat et de longitude lon l’indication ‘1’ si il y a la mer ‘0’
		sinon. C’est un fichier texte.</p>

	<p>Le premier octet correspond à la longitude -180 latitude 90, le
		dernier octet la longitude 180.°, latitude 90.0.</p>
	
   <p>Il y a donc (3601 * 1801) caractères dans ce fichier.</p>

   <p>Le même site propose une API qui permet de connaître
		l'élévation d'un point sur la carte. Une élévation négative
		est signe que l'on se trouve en mer... </p>
	
<pre>curl https://api.opentopodata.org/v1/etopo1?locations=39.747114,-104.996334

{
  &quot;results&quot;: [
    {
      &quot;elevation&quot;: 1596.0, 
      &quot;location&quot;: {
        &quot;lat&quot;: 39.747114, 
        &quot;lng&quot;: -104.996334
      },
      &quot;dataset&quot;: &quot;etopo1&quot;
    }
  ], 
  &quot;status&quot;: &quot;OK&quot;
}
</pre>
   <p>Noter que l’heuristique&nbsp;: on est en mer car l’élévation est positive n’est pas 
      toujours juste. Certaines parties terrestres sont en dessous du niveau de la mer…</p>

<h1 id="chap14">14. Les logiciels du marché </h1>

		<ul>
			<li>La rolls des logiciels de
			routage qui propose aussi la version Octopus pour la croisière
			<a href="https://www.adrena.fr/">Adrena</a>.</li>
			<li>L'entreprise Maxsea propose son
			produit <a href="https://mytimezero.com/fr">TimeZero</a>.</li>
			<li>Weather4D pro pour iPad et
			iPhone propose un module de routage <a href="https://www.weather4d.com/fr/">Weather4D</a>.</li>
			<li>Sailgrib Weather Routing pour Android propose aussi un
			module de routage <a href="https://www.sailgrib.com/">SailGrib</a>.</li>
			<li>Expedition&nbsp;:</li>
			<li>PredictWind&nbsp;: Le logiciel intègre des fichiers Grib haute
			résolution pour des prévisions précises.</li>
			<li>Deckman&nbsp;: Deckman, développé par B&amp;G, est un logiciel
			de navigation et de routage utilisé notamment dans le domaine de
			la course.</li>
			<li>SeaWeather&nbsp;:
			SeaWeather est conçue pour être utilisée avec les fichiers Grib
			et offre des fonctionnalités pour le calcul d'isochrones. Site
			Web&nbsp;: SeaWeather on GitHub. 
			</li>
         <li>Voir aussi <a href="https://www.scannav.com/GB/home.php">SCANNAV</a></li>
		</ul>

<h1 id="chap15">15. Approches en open source </h1>
		<h2>OpenCPN</h2>

      <p>OpenCPN est un logiciel de navigation maritime
		open source qui intègre des fonctionnalités de routage. Il prend
		en charge l'affichage de cartes marines, l'intégration de données
		météorologiques Grib, et offre des outils pour la planification
		d'itinéraires.</p>

		<p>Site Web&nbsp;: <a href="https://opencpn.org/index.html">openCPN</a>.</p>

		<p>Installation sous Ubuntu&nbsp;: <code>sudo apt-get install opencpn</code></p>

      <p>Les cartes marines du NOAA (US...) sont gratuites</p>
      <p>Pour la France, la recommandation est d'installer le plugin o-charts
      et d'aller sur le site o-charts <a href="https://o-charts.org/"> o_charts </a> pour faire 
      l'acquisition à prix modique de l'ensemble des cartes atlantiques.</p>

		<h2>QtVlm</h2>

      <p>QtVlm (Virtual Light Meter) est un logiciel
		gratuit sur PC qui offre des fonctionnalités de navigation et de
		routage pour les navigateurs à voile. Il prend en charge
		l'importation de fichiers Grib et propose des outils d'optimisation
		d'itinéraire.</p>

		<p>Installation via le site Web. Bien suivre les conseils de
		préinstallation.</p>

		<p>Distribué par <a href="https://www.meltemus.com/index.php/fr/">Meltemus</a>.</p>

		<h2>XyGrib</h2>

      <p>XyGrib est un logiciel open source permettant la
		visualisation de fichiers Grib. Bien qu'il ne soit pas
		spécifiquement un logiciel de routage, il est souvent utilisé en
		conjonction avec d'autres outils pour obtenir des prévisions
		météorologiques et planifier des itinéraires. C’est le
		successeur de Zygrib, soutenu par opengrib.</p>

		<p>Site web opengrib&nbsp;: <a href="https://opengribs.org/fr/xygrib-fr">XyGrib</a></p>

<h1 id="chap16">16. Bugs ou comportements particuliers</h1>
		<h2>16.1. Constantes CONST_...</h2>
   
      <p>Les constantes CONST_WIND_TWD, CONST_WAVE, CONST_CURRENT_S permettent de simuler un vent ou un courant constant, à des fins de tests ou de simulations. </p>

		<p>Si le vent est constant (avec CONST-TWD &gt; 0) alors les vagues
		sont de 0m sauf si CONST_WAVE&nbsp;&gt;&nbsp;0.</p>

		<p>En aucun cas, on ne peut prendre en compte des hauteurs de
		vagues venant du fichier Grib en ayant configuré un vent constant.
		En effet, un vent constant avec CONST_WIND_TWS inhibe la lecture
		des données associées au Grib qui contient les données du vent
		et des hauteur de vagues.</p>

		<p>Si par contre si le vent vient du Grib (CONS_WIND_TWD = 0) alors
		la hauteur des vagues est soit lue dans le fichier Grib (0 si
		valeur absente) soit égale à CONST_WAVE si CONST_WAVE&nbsp;&gt;&nbsp;0.</p>

		<p>Noter que les courants sont eux en général lus à partir d’un
		fichier Grib différent. Il n’y a donc pas de lien entre ce qui
		est configuré pour le vent et pour le courant (que l’on peut
		aussi rendre constant en configurant CONST_CURRENT_S &gt; 0.</p>

		<h2>16.2. Prise en compte du courants</h2>

		<p>Les composantes uCurr, vCurr en mètres par secondes et issue des
		fichiers Grib courant sont pris en compte dans le calcul des
		isochrones.</p>

		<p>Par contre, il est ignoré entre le dernier isochrone et la
		destination (fonction GoalP).</p>

		<h2>16.2. Antemeridian</h2>
      Lorque le Grib est à cheval sur l'antéméridien (180°), le comportement du logiciel peut ne pas être approprié.
      Notamment en ce qui concerne la visualisation.

      <h2>16.3. Téléchargements NOAA ou ECMWF</h2>
      Suite à des téléchargements volumineux, des cas de plantage sont observés. Le téléchargement se fait. Mais il peut être nécessaire de relancer
      le logiciel. Le nouveau Grib sera bien pris en compte.

<h1 id="chap17">17. Éléments bibliographiques </h1>

		<h2>Livres</h2>

		<p>&quot;Weather Routing: A Guide to Modern Meteorological
		Techniques&quot; par David Burch Ce livre se concentre sur le
		routage météorologique en navigation, couvrant les aspects
		pratiques et théoriques. Il offre des conseils sur l'utilisation
		des prévisions météorologiques pour optimiser les routes.</p>

		<p>&quot;Ocean Passages for the World&quot; par Rod Heikell et Andy
		O'Grady Bien que centré sur les grandes traversées océaniques,
		ce livre aborde des concepts clés liés au routage et à la
		planification de voyages en voilier.</p>

		<p>&quot;Modern Marine Weather: From Time-honored Maritime
		Traditions to the Latest Technology&quot; par David Burch et Tobias
		Burch Un guide complet sur la météorologie maritime, couvrant
		également les technologies modernes telles que les fichiers Grib.</p>

		<h2>Articles et Ressources en Lignes</h2>

		<p>&quot;The Art and Science of Racing Sailboats&quot; par Steve
		Colgate et Daniela Pegna Cet article explore les aspects techniques
		de la navigation à voile, y compris le calcul des performances du
		bateau et la prise de décisions tactiques.</p>

		<p>&quot;Optimization of Sailboat Routes under Weather Uncertainty&quot;
		par Omid Ghaemi, Saman Hassanzadeh, et Sean C. Kung Un article
		académique qui aborde les aspects mathématiques de l'optimisation
		des routes de voiliers sous incertitude météorologique.</p>

		<p>&quot;A High-Resolution Grib File Viewer for Sailing Navigation&quot;
		par Antonio Benetti, Andrea Monaci, et Roberto Montanari Un article
		qui décrit le développement d'un visualiseur Grib pour la
		navigation à voile.</p>

		<p>&quot;Weather Routing: The Hows and Whys&quot; par Stan Honey Un
		article pratique sur les principes et les méthodes du routage
		météorologique en voile.</p>

   <h2> Thèses </h2>
		<p><a href="http://homepages.engineering.auckland.a/">http://homepages.engineering.auckland.a</a></p>

   <h2> Liens académiques </h2>
   <ul>
      <li> <a href = "https://orsnz.org.nz/conf35/papers/AndrewMasonAndy.pdf"> Optimal Sailing Routes witd Uncertain Weatder, Allsop Philpott Mason, Department of Engineering Science, University of Auckland, New Zealand, 2000</a></li>

      <li> <a href = "https://www.researchgate.net/publication/255596181_Optimising_Yacht_Routes_under_Uncertainty">Optimising Yacht Routes under Uncertainty by Andy Philpott, Yacht Research Unit,University of Auckland, New Zealand Andrew Mason, Department of Engineering Science, University of Auckland, New Zealand, 2001</a></li>
   </ul>

<h1 id="chap18">18. Programmation</h1>
	<h2>18.1. Principes généraux </h2>

   <p> Le logiciel Rcube est écrit en langage C. La version c11 est utilisée. Il existe 3 petits scripts python 
      dans le répertoire py, utilisables pour le chargement des fichiers Grib par mail. On peut se passer de ces scripts car l
      l'équivalent a été développé en langage C. Pour éviter les scripts python, parametre PYTHON:0</p>

   <p>Le graphisme est géré en langage C avec GTK4 avec une version supérieure à:&nbsp;4.1</p>

   <p>GTK (The GIMP Toolkit) est un ensemble de bibliothèques développées originellement pour les besoins 
      du logiciel de traitement d'images GIMP. 
      GTK est maintenant utilisé dans de nombreux projets, dont les environnements de bureau GNOME, Xfce, Lxde et ROX. 
      GTK est un projet libre (licence GNU LGPL 2.1) et multiplate-forme.</p>

   <p>Les autres librairies utilisées sont&nbsp;:
   <ul>
      <li>Les librairies liées à  GTK4, et notamment la Glib,</li>
      <li>shapelib (pour la représentation des fonds de carte),</li>
      <li>eccodes (pour le décodage des fichiers Grib,</li>
      <li>curl (pour le téléchargement de fichiers Grib).</li>
   </ul>

   <p>Le répertoire csource4 contient le code C.</p>

   <table>
      <caption>Fichiers et actions associées</caption>
      <thead>
      <tr>
         <th>Fichier</th><th>Commentaire</th>
      </tr>
      </thead>
      <tbody>
         <tr>
            <td>rtypes.h</td><td>Définition des constantes générales <code>#defines</code>, des 
            <code>enum</code> et des <code>typedef</code>.</td>
         </tr>
         <tr>
            <td>inline.h</td><td>Définition des petites fonctions inline incluses dans les fichiers .c</td>
         </tr>
         <tr>
            <td>options.c</td><td>Gestion des options du mode CLI (command Line Interface).</td>
         </tr>
         <tr>
            <td>engine.c</td><td>Cœur du programme avec calcul des isochrones.</td>
         </tr>
         <tr>
            <td>engine.h</td><td>Interface de engine (prototypes des fonctions externes).</td>
         </tr>
         <tr>
            <td>aisgps.c</td><td>Gestion du GPS et de l'AIS.</td>
         </tr>
         <tr>
            <td>aisgps.h</td><td>Interface de aisgps (prototypes des fonctions externes).</td>
         </tr>
         <tr>
            <td>rutil.c</td><td>Fonctions utiles non graphiques ne dépendant pas de GTK4.</td>
         </tr>
         <tr>
            <td>rutil.h</td><td>Interface de rutil (prototypes des fonctions externes).</td>
         <tr>
            <td>mailutil.c</td><td>Interface pour la gestion mail.</td>
         </tr>
         <tr>
            <td>mailutil.h</td><td>Interface de mailutil (prototypes des fonctions externes).</td>
         </tr>
         <tr>
            <td>show4.c</td><td>Le main et les interfaces graphiques s'appuyant sur GTK4.</td>
         </tr>
      </tbody>
   </table>

      <p>La documentation Doxygen est disponible dans le répertoire csources.4/html&nbsp;
      <a href= "../csources4/html/index.html">Doxygen Doc</a></p>

		<h2>18.2. Style et documentation</h2>

		<p>Doxygen est donc utilisé pour produire la documentation. </p>

		<p>L’anglais américain est utilisé pour les identificateurs
		(constantes, variables, fonction, etc) et les commentaires.</p>

		<p>Les commentaires préférés sont de type <code>//</code>.</p>

      <p>Les fonctions et <code>typedef</code> sont précédés de commentaires interprétables par Doxygen et précisant la nature du typedef ou de la fonction.</p>
      <code>/*! Description */</code>

		<p>Les <code>#define</code> et les <code>const</code> sont en majuscule avec _ comme séparateur</p>
<pre>		
<code>#define MAX_N_ISOC 512</code>
<code>const int X_TOP = 1;</code>
</pre>

		<p>Les noms des variables et fonction sont en minuscules, en utilidant la notation camel.</p>
      
      <p>Exemple : ceciEstConformeNotationCamel</p>

		<p>Les nom des définitions de types commencent par une majuscule, le
		reste est en majuscule.</p>

		<p>Les décimaux sont tous de type double. Le type float n’est pas
		utilisé. Les constantes de type double sont suffixées par .0 au besoin,
		pour éviter les ambigüités avec les types entiers.</p>

		<p>Le type <code>bool</code> est largement utilisé avec les valeurs associées
		<code>true, false</code>.</p>
<pre>
<code>
myInt = 10;
double myDouble = 10.5;
double myOtherDouble = 10.0;
myBool = false;
</code>
</pre>

<h2>18.3. Vérification du code</h2>

		<p>Des directives de compilation strictes sont utilisées pour vérifier le code
		voir ccall4.

      <p> cppcheck est utilisé pour compléter la vérification statique du code.</p>

      <p> gcc analyser est également utilisé.</p>

		<p> Voir le fichier check.</p>

		<h2>18.4. Fenêtres et boites de dialogue</h2>

		<p>Toutes les fenêtres et boites de dialogues autres que infoMessage sont
		crées avec&nbsp;: <code>gtk_application_window_new </code>

      <p> <code>entryBox</code> est utilisée plusieurs fois et fait donc appel à <code>gtk_application_window_new </code>

		<p>Elle fait appel à <code>OKCancel</code>.</p>

		<p> <code>OKCancelLine</code>
		est utilisé par Entry Box et par&nbsp;</p>
	
	<p>
<pre><code> 
onChooseDepartureButtonClicked
nmeaConf
gribNoaa
mailRequestBox
</code></pre>

      <p><code>fCalendar</code> propose aussi des boutons OK Cancel sans appeler
		OKCancelLine.</p>

		<p> Toutes les autres fenêtres sont non modales, ne proposent pas de boutons
		ok cancel et sont et également créées avec <code>gtk_application_window_new</code>. </p>

		<h2>18.5. Bibliothèque Glib</h2>

<h3>Constantes</h3>
<pre>
G_PI
</pre>
<h3>Macros</h3>
<pre>
MAX
MIN
CLAMP
G_APPROX_VALUE
GPOINTER_TO_INT
GINT_TO_POINTER
</pre>
<h3>Fonctions</h3>

<p>String</p>
<pre>
g_ascii_isspace
g_strlcat
g_strlcpy
g_utf8_strup
g_utf8_casefold
g_strdelimit
g_strstrip
g_str_has_prefix
g_str_has_suffix
g_strdup_printf
g_markup_printf_escaped
g_strstr_len
g_strnfill
g_strsplit
g_strfreev
g_ascii_strdown
g_string_new
g_string_append
g_string_free
</pre>

<p>Time</p>
<pre>
g_timeout_add
g_timeout_add_seconds
g_date_time_get_day_of_month
g_date_time_get_month
g_date_time_get_year
g_date_time_new_utc
g_date_time_unref
</pre>

<p>Regex </p>
<pre>
g_regex_new
g_regex_match
g_regex_unref
</pre>

<p>Hash Table </p>
<pre>
g_hash_table_new_full
g_hash_table_insert
g_hash_table_iter_init
g_hash_table_iter_next
g_hash_table_iter_remove
g_hash_table_lookup
g_hash_table_destroy
</pre>

<p>File</p>
<pre>
g_path_get_dirname
g_path_get_basename
g_file_get_contents
g_file_get_path
g_build_filename
g_dir_open
g_dir_close
</pre>

<p>misc</p>
<pre>
g_free
g_locale_to_utf8
g_clear_error
g_thread_new
</pre>

		<h2>18.6. Lecture des données NMEA</h2>

		<p>La lecture se fait via les interfaces USB. On peut connecter plusieurs capteurs.</p>

		<p>Le fichier <code>routing.par</code> contient la liste des ports. Exemple sous Unix
		(Linus, MacOS...)</p>
<pre>
<samp>NMEA: /dev/ttyACM0 13 </samp>
<samp>NMEA: /dev/ttyUSB0 15 </samp> 
</pre>
      <p>
		13 est associé à la vitesse 9600 bauds<br>
      14 est associé à la vitesse 38400 bauds.</p>
		
      <p> Sous Windows, on aura&nbsp;:
<pre>
<samp>NMEA&nbsp;: COM3 9600</samp>
<samp>NMEA&nbsp;: COM4 38400</samp>
</pre>
		<p class="warning"> Attention&nbsp;:
	   <uL>
      <li>bien identifier les ports,</li>
      <li>s’assurer que la vitesse est correcte,</li>
      <li>sous Unix, vérifier que les droits d’accès
		existent. Au besoin passer la commande (1)&nbsp;:<br>
		<code>sudo chmod 666 /dev/ttyUSB0</code>.</li>
      </ul>

      <i>Note&nbsp;1&nbsp;: La commande peut être lancé via le menu GPS/AIS, sous-menu NMEA Ports.</i>
      <p></p>

      <h2>18.7. Icônes GTK4</h2>
		Voir&nbsp;:
	   <a href="https://specifications.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html">https://specifications.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html</a>
		<p>Application gnome pour associer nom d’icones et images&nbsp;: <br>
      <code>gtk4-icon-browser</code></p>

		<h2>18.8. Scripts python</h2>
		
      <p><strong>smtp.py</strong> envoie une requete via mail et a 4
		paramètres&nbsp;:</p>
      <code>smtp.py &lt;emetteur&gt; &lt;objet&gt; &lt;body&gt; &lt;password&gt;</code>

		<p><strong>imaptoseen.py</strong> fait passer tous les messages à
		lu avant l'envoi de la requête et a 1 parametre&nbsp;:</p>
		<code>imaptoseen.py &lt;password&gt;</code>

		<p><strong>imap.py</strong> va chercher les mails, sélectionne les
		&quot;non lu&quot; et copie le fichier attaché dans le répertoire
		&lt;path&gt;. Avec 2 paramètres&nbsp;:</p>
		<code>imap.py &lt;path&gt; &lt;password&gt;</code>

		<p>Exemple&nbsp;:</p>
<pre>
<code>python3 /home/rr/routing/py/smtp.py query@saildocs.com grib &quot;send gfs:47N,49N,4W,1W|0.20,0.20|0,3,..144|WIND,GUST,WAVES,RAIN,PRMSL&quot; pw</code>

In smtp.py: Message sent to on port 465&nbsp;: query@saildocs.com
subject: grib body: send
gfs:47N,49N,4W,1W|0.20,0.20|0,3,..144|WIND,GUST,WAVES,RAIN,PRMSL

<code>rr@rr-Zenbook-UX3402ZA-UX3402ZA:~/routing/py$ python3 /home/rr/routing/py/imaptoseen.py pw</code>

In imaptoseen.py: Tous les messages ont été marqués comme lus.

<code>rr@rr-Zenbook-UX3402ZA-UX3402ZA:~/routing/py$ python3 /home/rr/routing/py/imap.py /home/rr/routing/grib pw</code>
</pre>

		<h2>18.9. Fichier Par</h2>

      <p>Les fichiers suffixés par ".par" sont situés dans le répertoire "par".</p>

      <p>Le fichier par défaut est "routing.par" et est essentiel pour le bon fonctionnement de RCube.</p>

      <p>Un fichier ".par" est un fichier texte comportant des lignes de la forme&nbsp;:</p>

      <p><samp>NOM: valeur</samp></p>

      <p>Des commentaires peuvent être ajoutés après le signe "#".</p>

      <p>Exemple&nbsp;:</p>
<pre><samp>
PORT:            geo/port.csv  # nom du fichier port
POR:             35.86,-41.37  # latitude et longitude du point Origine
MOTOR_S:         6.00          # vitesse en noeuds au moteur
DMS_DISP:        2             # DMS dipplay de type Degrés Minutes Secondes
SMTP_SCRIPT:     python3 /home/rr/routing/py/smtp.py  #script python pour l'envoi de mail SMTP
</samp></pre>

		<p>Informations sur les paramètres&nbsp;: <a href="docpar.txt">docpar.txt</a></p>

		<p>Exemple de fichier par&nbsp;: <a href="../par/routing.par">../par/routing.par</a></p>

		<p>Exemple de fichier par pour Windows&nbsp;:

		<a href="../par/routingwindows.par">../par/routingwindows.par</a></p>

		<p>&nbsp;</p>
</div>
<div class="notes">

<h2>Liens </h2>

<p><a href= "../csources4/html/index.html">Doxygen</a></p>
<p><a href= "docpar.txt">Documentation sur les paramètres</a></p>
<p><a href= "clihelp.txt">Help pour le mode CLI (Command Line Interface)</a></p>
<p><a href="https://saildocs.com/gribmodels">Informations sur les Grib models de Saildoc</a></p>
<p><a href="https://nomads.ncep.noaa.gov/">Fichiers Grib NOAA</a></p>
<p><a href="https://data.ecmwf.int/">Fichiers Grib ECMWF</a></p>
<p><a href="https://meteo.data.gouv.fr/">Fichiers Grib Météo France</a></p>
<p><a href="https://marine.meteoconsult.fr/services-marine/fichiers-grib">Fichiers Grib Meteo consult</a></p>

<h2>Météo locale </h2>
<table>
   <tr>   
      <td>Météo</td><td><div id = "meteo"></div></td>
   </tr>
   <tr>
      <td>Température</td><td><div id = "temp"></div></td>
   </tr>
   <tr>
      <td>Humidité</td><td><div id = "humide"></div></td>
   </tr>
   <tr>
      <td>Vent</td><td><div id = "vent"></div></td>
   </tr>
   <tr>
      <td>Pression</td><td><div id = "pression"></div></td>
   </tr>
</table>
<p></p>

<table>
  <caption>Echelle Beaufort</caption>
   <thead>
   <tr>   
      <th>Beaufort</th>
      <th>Termes</th>
      <th>Noeuds</th>
      <th>Km/h</th>
      <th>m/s</th>
   </tr>
   </thead>
   <tr>
      <td>0</td>
      <td>Calme</td>
      <td>0 à 1</td>
      <td>0 à 1</td>
      <td>0 à 1</td>
   </tr>
   <tr>
      <td>1</td>
      <td>Très légère brise</td>
      <td>1 à 3</td>
      <td>1 à 5</td>
      <td>0.5 à 1.5</td>
   </tr>
   <tr>
      <td>2</td>
      <td>Légère brise</td>
      <td>4 à 6</td>
      <td>6 à 11</td>
      <td>1.5 à 3.3</td>
   </tr>
   <tr>
      <td>3</td>
      <td>Petite brise</td>
      <td>7 à 10</td>
      <td>12 à 19</td>
      <td>3.4 à 5.5</td>
   </tr>
   <tr>
      <td>4</td>
      <td>Jolie brise</td>
      <td>11 à 16</td>
      <td>29 à 28</td>
      <td>5.6 à 8</td>
   </tr>
   <tr>
      <td>5</td>
      <td>Bonne brise</td>
      <td>17 à 21</td>
      <td>29 à 38</td>
      <td>8 à 11</td>
   </tr>
   <tr>
      <td>6</td>
      <td>Vent frais</td>
      <td>22 à 27</td>
      <td>22 à 27</td>
      <td>11 à 14</td>
   </tr>
   <tr>
      <td>7</td>
      <td>Grand frais</td>
      <td>28 à 33</td>
      <td>50 à 61</td>
      <td>14 à 17</td>
   </tr>
   <tr>
      <td>8</td>
      <td>Coup de vent</td>
      <td>34 à 40</td>
      <td>62 à 74</td>
      <td>17 à 21</td>
   </tr>
   <tr>
      <td>9</td>
      <td>Fort coup de vent</td>
      <td>41 à 47</td>
      <td>75 à 88</td>
      <td>21 à 24.5</td>
   </tr>
   <tr>
      <td>10</td>
      <td>Tempête</td>
      <td>48 à 55</td>
      <td>89 à 102</td>
      <td>24.4 à 28.4</td>
   </tr>
   <tr>
      <td>11</td>
      <td>Violente tempête</td>
      <td>56 à 63</td>
      <td>103 à 117</td>
      <td>28.4 à 32.6</td>
   </tr>
   <tr>
      <td>12</td>
      <td>Ouragan</td>
      <td>>= 64 </td>
      <td>>= 118 </td>
      <td>0 à 32.6</td>
   </tr>
</table>

<h2>Les principaux sites marées en France</h2>
<ul>
   <li> <a href = "http://maree.info">Marée Info</a></li>
   <li> <a href = "https://shom.fr">SHOM</a></li>
</ul>

<p><script src="https://services.data.shom.fr/hdm/vignette/petite/LE_POULIGUEN?locale=fr"></script></p>

<h2>Autres liens utiles</h2>
<ul>
   <li> <a href = "https://www.premar-atlantique.gouv.fr/avis-urgents-aux-navigateurs"> AVURNAV Préfecture maritime</a></li>
   <li> <a href = "https://francis-fustier.fr/"> MAC fanas : le site de Francis Fustier </a></li>
   <li> <a href = "https://weather.mailasail.com/Franks-weather"> Weather by Frank Singleton </a></li>
</ul>


</div>

</div>
<hr>

<footer>
René Rigault, 2024
</footer>

</body>
</html>
